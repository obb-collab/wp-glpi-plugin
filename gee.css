/*
  Объединённый CSS-файл интерфейса GLPI
  — карточки, панель фильтрации, модальные окна и действия
*/

/* === БАЗА === */
:root {
  --glpi-gap-lg: 24px;
  --glpi-gap-xl: 32px;
}

body {
  background-color: #111827;
  color: #e2e8f0;
  font-family: system-ui, sans-serif;
  margin: 0;
  padding: 0;
  overflow-x: hidden;
}
.glpi-container { width: 100%; padding: 0 16px; margin: 0 auto; box-sizing: border-box; }

/* === СЕТКА КАРТОЧЕК === */
.glpi-wrapper {
  width: 100%;
  max-width: 100%;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
  gap: 32px;
  box-sizing: border-box;
  margin: 0 auto;
  padding: 0 16px;
}
@media (max-width: 1200px) { .glpi-wrapper { grid-template-columns: repeat(2, 1fr); } }
@media (max-width: 768px) {
  .glpi-wrapper { display: flex; flex-direction: column; align-items: center; padding: 0 12px; gap: 16px; }
  .glpi-card { width: 100%; max-width: 100%; }
}

/* === КАРТОЧКА === */
.glpi-card {
  background-color: #1e293b;
  border-radius: 12px;
  padding: 16px 16px 48px 16px;
  display: flex;
  flex-direction: column;
  position: relative;
  overflow: visible;
  box-shadow: 0 0 0 rgba(0, 0, 0, 0.2);
  transition: box-shadow .3s ease, transform .2s ease;
}
.glpi-card:hover { box-shadow: 0 0 12px 2px #3b82f6; transform: translateY(-2px); }

.glpi-card-header { display: flex; justify-content: space-between; align-items: flex-start; padding-top: 28px; margin-bottom: 12px; }
.glpi-topic {
  color: #fff;
  font-weight: 700;
  font-size: 15px;
  line-height: 1.2;
  text-decoration: none;
  flex: 1 1 auto;
  margin-right: 8px;
  max-width: 100%;
  overflow: visible;
  white-space: normal;
  word-break: break-word;
  display: block;
}
@media (max-width:576px){
  .glpi-topic{font-size:14px;}
}
.glpi-ticket-id { font-size: 13px; color: #64748b; }
.glpi-card-body { font-size: 14px; color: #cbd5e1; line-height: 1.4; margin-bottom: 12px; max-height: 2.8em; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; }

.glpi-executor-footer { position: absolute; bottom: .5rem; left: .75rem; font-size: 12px; color: #94a3b8; display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
.glpi-executor-footer i { margin-right: 4px; opacity: .6; }
.glpi-date-footer { position: absolute; bottom: .5rem; right: .75rem; font-size: 12px; font-weight: 500; color: #9ca3af; }
.glpi-date-footer.age-green  { color: #28a745 !important; }
.glpi-date-footer.age-red    { color: #dc3545 !important; }
.glpi-date-footer.age-orange { color: #fd7e14 !important; }
.glpi-date-footer.age-blue   { color: #3b82f6 !important; }
.glpi-date-footer.age-black  { color: #808080 !important; }

/* чип со счётчиком комментариев */
.glpi-comments-chip{ display:inline-flex; align-items:center; gap:6px; padding:2px 8px; border-radius:999px; background:#0b1220; border:1px solid #243045; color:#cbd5e1; }
.glpi-comments-chip i{ opacity:.9; }

/* Бейдж категории (угол) */
.glpi-badge {
  position: absolute; top: -8px; left: -10px;
  display: inline-flex; align-items: center; gap: 6px;
  font-size: 12px; font-weight: 600; color: #fff;
  padding: 4px 10px; border-radius: 6px; background-color: #334155;
  white-space: nowrap; z-index: 2; pointer-events: none;
  box-shadow: 0 2px 6px rgba(0,0,0,.2);
}
.glpi-badge.printer{background:#3b82f6}.glpi-badge.po{background:#f59e0b}.glpi-badge.network{background:#10b981}.glpi-badge.infosec{background:#a855f7}.glpi-badge.ebmias{background:#ec4899}.glpi-badge.default{background:#6b7280}

/* === ПАНЕЛЬ ФИЛЬТРАЦИИ === */
 .glpi-filtering-panel{margin-bottom:24px;}
 .glpi-header-row{position:sticky;top:0;z-index:100;display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;gap:16px;padding:16px 24px;background:#111827;}
.glpi-header-left,.glpi-header-center,.glpi-header-right{display:flex;align-items:center;gap:16px;}
.glpi-header-center{flex:1 1 auto;justify-content:center;overflow-x:auto;flex-direction:column;gap:0;}
 .glpi-header-right{flex-wrap:wrap;justify-content:flex-end;}
 .glpi-status-blocks{display:flex;flex-wrap:nowrap;gap:12px;}
 .glpi-status-block,
 .glpi-newfilter-block{display:flex;flex-direction:column;justify-content:center;align-items:center;min-width:120px;min-height:72px;padding:12px 14px;border-radius:12px;background:#1f2937;color:#e5e7eb;box-shadow:0 2px 8px rgba(0,0,0,.25);cursor:pointer;user-select:none;transition:transform .08s ease, background-color .15s ease, box-shadow .15s ease;}
 .glpi-status-block .status-count,
 .glpi-newfilter-block .status-count{font-size:28px;line-height:1;font-weight:800;}
 .glpi-status-block .status-label,
 .glpi-newfilter-block .status-label{margin-top:6px;font-size:12px;letter-spacing:.02em;opacity:.9;white-space:nowrap;}
 .glpi-status-block:hover,
 .glpi-newfilter-block:hover{transform:translateY(-2px);background:#273447;box-shadow:0 4px 14px rgba(0,0,0,.3);}
 .glpi-status-block.active,
 .glpi-newfilter-block.active{background:#facc15;color:#1f2937;}
 .glpi-status-block.active .status-count,
 .glpi-newfilter-block.active .status-count{color:#111827;}
 .glpi-status-block.active .status-label,
 .glpi-newfilter-block.active .status-label{color:#111827;opacity:1;font-weight:700;}
.glpi-search-block{display:flex;flex-direction:column;position:relative;}
.glpi-search-input{all:unset;width:100%;max-width:340px;box-sizing:border-box;background:#1e293b!important;color:#f8fafc!important;padding:10px 34px 10px 14px;border:1px solid #334155;border-radius:6px;font-size:14px;}
.gexe-search-clear{position:absolute;right:8px;top:50%;transform:translateY(-50%);background:transparent;border:0;color:#94a3b8;width:32px;height:32px;display:flex;align-items:center;justify-content:center;cursor:pointer;}
.gexe-search-clear:hover{color:#f1f5f9;}
 .glpi-search-input::placeholder{color:#64748b;}
.glpi-search-input:focus{outline:none;border-color:#facc15;box-shadow:0 0 0 2px rgba(250,204,21,.3);}
.gexe-greeting{color:#facc15;font-weight:700;margin-bottom:12px;}
@media (max-width:480px){.gexe-greeting{margin-bottom:8px;}}
 .glpi-newtask-btn{display:flex;align-items:center;gap:8px;padding:10px 16px;border-radius:6px;background:#1f2937;color:#e5e7eb;border:1px solid #334155;cursor:pointer;transition:background-color .15s ease;white-space:nowrap;}
 .glpi-newtask-btn:hover{background:#273447;}
.glpi-category-block{position:relative;}
.glpi-cat-toggle{display:flex;align-items:center;gap:8px;padding:10px 16px;border-radius:6px;background:#1f2937;color:#e5e7eb;border:1px solid #334155;cursor:pointer;transition:background-color .15s ease;}
.glpi-cat-toggle:hover{background:#273447;}

/* Инлайн-категории */
.glpi-categories-inline{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin:8px 0;
  padding:12px;
  background:#0f172a;
  border:1px solid #334155;
  border-radius:12px;
  box-shadow:0 2px 4px rgba(0,0,0,.3);
  margin-bottom:var(--glpi-gap-lg);
}

@media (min-width:1280px){
  .glpi-categories-inline{margin-bottom:var(--glpi-gap-xl);}
}
.glpi-cat-chip{display:flex;align-items:center;gap:6px;padding:6px 10px;border-radius:8px;background:#1e293b;color:#e5e7eb;font-size:14px;cursor:pointer;white-space:nowrap;}
.glpi-cat-chip:hover{box-shadow:0 0 0 1px #475569;}
.glpi-cat-chip.active{background:#facc15;color:#1e1e1e;font-weight:700;}
.glpi-cat-reset{margin-left:auto;background:transparent;border:0;color:#94a3b8;cursor:pointer;}
.glpi-cat-reset:hover{color:#f1f5f9;}

@media (max-width:768px){
  .glpi-header-row{flex-direction:column;align-items:stretch;}
  .glpi-header-left,.glpi-header-center,.glpi-header-right{width:100%;justify-content:flex-start;}
  .glpi-header-center{overflow-x:auto;}
  .glpi-header-right{justify-content:space-between;}
  .glpi-search-input{max-width:100%;}
}

@media (max-width:480px){
  .glpi-header-center{overflow-x:visible;}
  .glpi-status-blocks{flex-wrap:wrap;gap:6px;}
  .glpi-status-block{min-width:auto;flex:1 1 auto;padding:6px 10px;min-height:40px;}
  .glpi-status-block .status-count{font-size:20px;}
  .glpi-status-block .status-label{margin-top:4px;font-size:12px;}
}

/* Выпадающие (общие) */
.glpi-filter-dropdown .glpi-filter-menu{ background:#0f172a; border:1px solid #334155; border-radius:8px; box-shadow:0 6px 12px rgba(0,0,0,.3); }

/* Кнопки в выпадашке */
.glpi-filter-btn{ display:block; width:100%; padding:8px 12px; margin:2px 0; border-radius:6px; background:#1e293b; color:#f1f5f9; border:none; text-align:left; font-size:14px; cursor:pointer; white-space:nowrap; transition:background-color .2s, color .2s; }
.glpi-filter-btn:hover{ background:#334155; }
.glpi-filter-btn.active{ background:#facc15; color:#1e1e1e; font-weight:700; }

/* Действия на карточке (рядом с бейджем) */
.gexe-card-actions{ position:absolute; top:-10px; right:-10px; display:flex; gap:8px; z-index:3; }
.gexe-action-btn{ background:#0b1220; color:#e5e7eb; border:1px solid #243045; border-radius:8px; padding:8px 10px; cursor:pointer; box-shadow:0 2px 6px rgba(0,0,0,.25); }
.gexe-action-btn:hover{ background:#111b2e; }
.gexe-action-btn:disabled{ background:#1e293b; color:#64748b; border-color:#334155; cursor:not-allowed; box-shadow:none; }
.gexe-preflight-guard{ color:#facc15; display:inline-flex; align-items:center; margin-left:4px; }

/* ======= Модалка просмотра ======= */
.gexe-modal{ position:fixed; inset:0; display:none; z-index:10000; }
.gexe-modal.gexe-modal--open{ display:block; }
.gexe-modal__backdrop{ position:absolute; inset:0; background:rgba(0,0,0,.55); backdrop-filter: blur(2px); }
.gexe-modal__dialog{ position:absolute; top:45%; left:50%; transform:translate(-50%,-50%); width:min(980px,94vw); max-height:88vh; overflow:auto; background:#0f172a; border:1px solid #334155; border-radius:12px; box-shadow:0 20px 60px rgba(0,0,0,.5); }
.gexe-modal__close{ position:sticky; top:8px; left:calc(100% - 40px); margin:8px; border:0; background:transparent; color:#94a3b8; font-size:28px; line-height:1; cursor:pointer; z-index:2; }
.gexe-modal__close:hover{ color:#f1f5f9; }
.gexe-modal__content{ padding:16px; }
.glpi-modal__comments{ padding:0 16px 16px 16px; border-top:1px dashed #334155; margin-top:8px; }
.glpi-modal__comments-title{ font-weight:700; margin:4px 0 8px 0; color:#e5e7eb; }
.glpi-modal__comments-body{ display:grid; gap:10px; }
.glpi-comments-loading{ color:#94a3b8; padding:8px; font-style:italic; }

/* Комментарии */
.glpi-comment{ background:#1e293b; border:1px solid #334155; border-radius:8px; padding:8px 12px; color:#e2e8f0; font-size:14px; }
.glpi-comment + .glpi-comment{ margin-top:8px; }
.glpi-comment.glpi-comment--pending{ opacity:.85; font-style:italic; }
.glpi-comment--pending .glpi-comment-status{ display:flex; align-items:center; gap:6px; }
.glpi-comment-spinner{ width:12px; height:12px; border:2px solid #94a3b8; border-top-color:transparent; border-radius:50%; animation:glpi-spin 1s linear infinite; }
.glpi-comment--stopped .glpi-comment-spinner{ animation:none; border-top-color:#94a3b8; }
@keyframes glpi-spin{ to{ transform:rotate(360deg); } }
.glpi-comment--skeleton{ position:relative; overflow:hidden; }
.glpi-comment--skeleton .meta,.glpi-comment--skeleton .text{ background:#334155; border-radius:4px; }
.glpi-comment--skeleton .meta{ height:12px; margin-bottom:4px; }
.glpi-comment--skeleton .text{ height:32px; }
.glpi-comment--skeleton::before{ content:''; position:absolute; inset:0; transform:translateX(-100%); background:linear-gradient(90deg,transparent,rgba(255,255,255,.1),transparent); animation:glpi-skel 1.2s infinite; }
@keyframes glpi-skel{ to{ transform:translateX(100%); } }
.glpi-comment .meta{ font-size:12px; color:#94a3b8; margin-bottom:4px; display:flex; justify-content:space-between; align-items:center; }
.glpi-comment .meta .glpi-comment-author{ display:flex; align-items:center; gap:4px; }
.glpi-comment-date.age-green{ color:#28a745 !important; }
.glpi-comment-date.age-red{ color:#dc3545 !important; }
.glpi-comment-date.age-orange{ color:#fd7e14 !important; }
.glpi-comment-date.age-blue{ color:#3b82f6 !important; }
.glpi-comment-date.age-black{ color:#808080 !important; }
.glpi-comment .text{ line-height:1.4; }
.glpi-comment .glpi-txt{ margin:0 0 4px 0; }
.glpi-empty{ text-align:center; padding:12px 0; color:#94a3b8; font-size:13px; }

/* Внутри модалки карточка попроще */
.glpi-card--in-modal{ box-shadow:none !important; transform:none !important; padding-bottom:8px; }
.glpi-card--in-modal .glpi-card-body{
  -webkit-line-clamp:unset;
  white-space:pre-wrap;
  max-height:none;
  overflow:visible;
  text-overflow:unset;
  display:block;
}
.glpi-card--in-modal .glpi-executor-footer,
.glpi-card--in-modal .glpi-date-footer{ position:static; display:inline-block; margin:6px 12px 0 0; }

/* ======= Модалка комментария ======= */
/* ======= Модалки комментария и подтверждения ======= */
.gexe-cmnt, .gexe-done{ position:fixed; inset:0; display:none; z-index:11000; }
.gexe-cmnt.is-open, .gexe-done.is-open{ display:block; }
.gexe-cmnt__backdrop, .gexe-done__backdrop{ position:absolute; inset:0; background:rgba(0,0,0,.55); }
.gexe-cmnt__dialog, .gexe-done__dialog{ position:absolute; top:36%; left:50%; transform:translate(-50%,-50%); width:min(720px,92vw); background:#0f172a; border:1px solid #334155; border-radius:12px; box-shadow:0 20px 60px rgba(0,0,0,.5); overflow:hidden; }
.gexe-cmnt__head, .gexe-done__head{ display:flex; align-items:center; gap:8px; padding:10px 12px; background:linear-gradient(#0f172a, rgba(15,23,42,.92)); border-bottom:1px solid #334155; }
.gexe-cmnt__title, .gexe-done__title{ font-weight:700; color:#e5e7eb; }
.gexe-cmnt__close, .gexe-done__close{ margin-left:auto; border:0; background:transparent; color:#94a3b8; font-size:22px; cursor:pointer; }
.gexe-cmnt__close:hover, .gexe-done__close:hover{ color:#f1f5f9; }
.gexe-cmnt__body, .gexe-done__body{ padding:12px; }
#gexe-cmnt-text{ width:100%; min-height:80px; resize:vertical; border-radius:8px; border:1px solid #475569; background:#0b1220; color:#e5e7eb; padding:10px; }
.gexe-cmnt__foot{ padding:12px; border-top:1px solid #334155; }
#gexe-cmnt-send.glpi-act{background:#475569;border:1px solid #334155;color:#fff;border-radius:10px;font-weight:700;width:100%;display:block}
#gexe-cmnt-send.glpi-act:hover{background:#334155}
#gexe-done-confirm.glpi-act{background:#475569;border:1px solid #334155;color:#fff;border-radius:10px;font-weight:700;width:100%;display:block}
#gexe-done-confirm.glpi-act:hover{background:#334155}

button.is-loading{position:relative;}
button.is-loading::after{content:"";position:absolute;top:50%;left:50%;width:12px;height:12px;margin:-6px 0 0 -6px;border:2px solid currentColor;border-top-color:transparent;border-radius:50%;animation:gexe-spin .8s linear infinite;}
@keyframes gexe-spin{to{transform:rotate(360deg);}}
button[disabled]{cursor:not-allowed;opacity:.6;}

/* Утилиты */
.glpi-card.gexe-hide{display:none!important;}
.gexe-hide-executors{display:none!important;}
